<div class="container-fluid mt-4 mb-5">
  <div class="row">
    
    {{!-- LEFT SIDEBAR --}}
    <div class="col-lg-3 mb-4">
        {{> seller-sidebar activeSection='dashboard'}}
    </div>

    {{!-- RIGHT CONTENT --}}
    <div class="col-lg-9">
      
      {{!-- WELCOME HEADER --}}
      <div class="mb-4">
        <h2 class="display-6 text-dark mb-2">Welcome Back, {{authUser.fullname}}!</h2>
        <p class="text-muted">Here's your selling dashboard overview</p>
      </div>

      {{!-- STATS CARDS --}}
      <div class="row g-4 mb-4">
        
        {{!-- Total Products --}}
        <div class="col-md-3">
          <div class="card border-0 shadow-sm bg-light h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <p class="text-muted small mb-1">Total Products</p>
                  <h3 class="text-primary fw-bold mb-0">{{stats.total_products}}</h3>
                </div>
                <i class="bi bi-box-seam fs-2 text-primary opacity-50"></i>
              </div>
            </div>
          </div>
        </div>

        {{!-- Active Products --}}
        <div class="col-md-3">
          <div class="card border-0 shadow-sm bg-light h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <p class="text-muted small mb-1">Active Products</p>
                  <h3 class="text-success fw-bold mb-0">{{stats.active_products}}</h3>
                </div>
                <i class="bi bi-play-circle fs-2 text-success opacity-50"></i>
              </div>
            </div>
          </div>
        </div>

        {{!-- Sold Products --}}
        <div class="col-md-3">
          <div class="card border-0 shadow-sm bg-light h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <p class="text-muted small mb-1">Sold Products</p>
                  <h3 class="text-info fw-bold mb-0">{{stats.sold_products}}</h3>
                </div>
                <i class="bi bi-bag-check fs-2 text-info opacity-50"></i>
              </div>
            </div>
          </div>
        </div>

        {{!-- Total Revenue --}}
        <div class="col-md-3">
          <div class="card border-0 shadow-sm bg-light h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <p class="text-muted small mb-1">Total Revenue</p>
                  <h3 class="text-warning fw-bold mb-0">{{format_number stats.total_revenue}}</h3>
                </div>
                <i class="bi bi-cash-coin fs-2 text-warning opacity-50"></i>
              </div>
            </div>
          </div>
        </div>

      </div>

      {{!-- QUICK ACTIONS --}}
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-0 p-3 pb-2">
          <h5 class="card-title mb-0">Quick Actions</h5>
        </div>
        <div class="card-body">
          <div class="d-flex flex-wrap gap-2">
            <a href="/seller/products/add" class="btn btn-primary">
              <i class="bi bi-plus-circle"></i> Add New Product
            </a>
            <a href="/seller/products" class="btn btn-outline-primary">
              <i class="bi bi-list"></i> View All Products
            </a>
            <a href="/seller/products/sold" class="btn btn-outline-info">
              <i class="bi bi-bag-check"></i> Sold Products
            </a>
            <a href="/account/profile" class="btn btn-outline-secondary">
              <i class="bi bi-gear"></i> Settings
            </a>
          </div>
        </div>
      </div>

      {{!-- RECENT PRODUCTS --}}
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-0 p-3 pb-2 d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0">Recent Products</h5>
          <a href="/seller/products" class="btn btn-sm btn-outline-primary">View All</a>
        </div>
        <div class="card-body">
          {{#if (eq recentProducts.length 0)}}
            <p class="text-muted text-center py-4">No products yet. <a href="/seller/products/add">Create one now!</a></p>
          {{else}}
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th>Product Name</th>
                    <th>Current Price</th>
                    <th>Bids</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {{#each recentProducts}}
                  <tr>
                    <td>
                      <div class="d-flex align-items-center gap-2">
                        {{#if this.thumbnail}}
                          <img src="/static/{{this.thumbnail}}" alt="{{this.name}}" width="40" height="40" class="rounded" style="object-fit: cover;">
                        {{else}}
                          <div class="rounded" style="width: 40px; height: 40px; background: #f0f0f0;"></div>
                        {{/if}}
                        <span class="fw-bold">{{truncate this.name 30}}</span>
                      </div>
                    </td>
                    <td>{{format_number this.current_price}} VND</td>
                    <td><span class="badge bg-secondary">{{this.bid_count}}</span></td>
                    <td>
                      {{#if this.status}}
                        <span class="badge bg-success">{{this.status}}</span>
                      {{else}}
                        <span class="badge bg-warning">Pending</span>
                      {{/if}}
                    </td>
                    <td>
                      <div class="btn-group btn-group-sm" role="group">
                        <a href="/seller/products/{{this.id}}/edit" class="btn btn-outline-warning" title="Edit">
                          <i class="bi bi-pencil"></i>
                        </a>
                        <button class="btn btn-outline-danger btn-delete-product" data-product-id="{{this.id}}" title="Delete">
                          <i class="bi bi-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                  {{/each}}
                </tbody>
              </table>
            </div>
          {{/if}}
        </div>
      </div>

      {{!-- RECENT SOLD --}}
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-0 p-3 pb-2 d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0">Recent Sales</h5>
          <a href="/seller/products/sold" class="btn btn-sm btn-outline-primary">View All</a>
        </div>
        <div class="card-body">
          {{#if (eq recentSold.length 0)}}
            <p class="text-muted text-center py-4">No sales yet. Keep listing products!</p>
          {{else}}
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th>Product Name</th>
                    <th>Winner</th>
                    <th>Final Price</th>
                    <th>Sold Date</th>
                  </tr>
                </thead>
                <tbody>
                  {{#each recentSold}}
                  <tr>
                    <td>
                      <span class="fw-bold">{{truncate this.name 30}}</span>
                    </td>
                    <td>{{this.bidder_name}}</td>
                    <td><span class="text-success fw-bold">{{format_number this.current_price}} VND</span></td>
                    <td>{{format_date this.end_time}}</td>
                  </tr>
                  {{/each}}
                </tbody>
              </table>
            </div>
          {{/if}}
        </div>
      </div>

    </div>
  </div>
</div>

{{#section "js"}}
<script>
document.querySelectorAll('.btn-delete-product').forEach(btn => {
  btn.addEventListener('click', function(e) {
    e.preventDefault();
    const productId = this.getAttribute('data-product-id');
    
    if (confirm('Are you sure you want to delete this product?')) {
      fetch(`/seller/products/${productId}`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          location.reload();
        } else {
          alert('Error: ' + (data.message || 'Failed to delete product'));
        }
      })
      .catch(err => {
        console.error(err);
        alert('Error deleting product');
      });
    }
  });
});
</script>
{{/section}}
